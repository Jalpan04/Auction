<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy Cricket Auction</title>
    <link rel="stylesheet" href="css/style.css?v=11-UI-PARITY">
    <link rel="stylesheet" href="css/style_mobile.css?v=11-UI-PARITY">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="debug-console" style="display:none; position:fixed; top:0; left:0; width:100%; height:200px; background:rgba(0,0,0,0.9); z-index:9999; color:#0f0; overflow-y:scroll; font-family:monospace; padding:10px; border-bottom: 2px solid #0f0;">
        <div id="debug-log-content">DEBUG LOG START...</div>
    </div>
    <script>
        // Debug Toggle
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                const dbg = document.getElementById('debug-console');
                if(dbg) dbg.style.display = dbg.style.display === 'none' ? 'block' : 'none';
            }
        });
        
        window.onerror = function(msg, url, line) {
            console.error(msg);
            const content = document.getElementById('debug-log-content');
            if(content) content.innerHTML += `<br><span style="color:red">ERROR: ${msg} <br>Line: ${line}</span>`;
            const dbg = document.getElementById('debug-console');
            if(dbg) dbg.style.display = 'block';
            return false;
        };
        window.logDebug = function(msg) {
             const content = document.getElementById('debug-log-content');
             if(content) {
                 content.innerHTML += `<br>${msg}`;
                 const dbg = document.getElementById('debug-console');
                 if(dbg && dbg.scrollHeight) dbg.scrollTop = dbg.scrollHeight;
             }
        }
    </script>
    <div id="app" class="container">
        <!-- Auth View -->
        <section id="auth-view" class="view">
            <div class="auth-container" style="max-width: 400px; margin: 100px auto; text-align: center;">
                <h1 style="margin-bottom: 2rem;">CRICKET<span class="accent">AUCTION</span></h1>
                <div id="auth-forms" style="background: rgba(0,0,0,0.5); padding: 20px; border-radius: 10px;">
                    <!-- Tabs -->
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #555;">
                        <button id="tab-login" class="tab-btn active" style="flex: 1; background: none; border: none; color: white; padding: 10px; border-bottom: 2px solid var(--accent-color);">LOGIN</button>
                        <button id="tab-register" class="tab-btn" style="flex: 1; background: none; border: none; color: #888; padding: 10px;">REGISTER</button>
                    </div>

                    <input type="text" id="username-input" placeholder="Username (e.g. Gamer1)" required style="text-align: center; font-size: 1.2rem; margin-bottom: 10px; width: 100%;">
                    
                    <div style="position: relative;">
                        <input type="password" id="password-input" placeholder="Password" required style="text-align: center; font-size: 1.2rem; margin-bottom: 10px; width: 100%;">
                        <span id="toggle-password" style="position: absolute; right: 10px; top: 12px; cursor: pointer; color: #888; width: 24px; height: 24px;">
                            <!-- Eye Icon (Closed) -->
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88" />
                            </svg>
                        </span>
                    </div>

                    <div id="register-fields" class="hidden">
                        <input type="password" id="confirm-password-input" placeholder="Confirm Password" style="text-align: center; font-size: 1.2rem; margin-bottom: 10px; width: 100%;">
                    </div>

                    <div class="grid" style="grid-template-columns: 1fr; margin-top: 1rem;">
                        <button id="btn-enter" class="btn btn-primary" style="font-size: 1.2rem;">LOGIN</button>
                    </div>
                    
                    <div id="auth-msg" style="color: var(--error-color); margin-top: 10px; min-height: 20px;"></div>
                </div>
            </div>
        </section>

        <!-- Lobby View -->
        <section id="lobby-view" class="view hidden">
            <div class="lobby-container" style="max-width: 600px; margin: 100px auto; text-align: center;">
                <h2>WELCOME TO THE LOBBY</h2>
                <div class="user-info" style="margin: 2rem 0; color: var(--text-secondary);">
                    Logged in as: <span id="user-email" class="accent"></span>
                </div>
                
                <div class="grid" style="margin-bottom: 3rem;">
                    <div class="card" style="padding: 2rem; background: var(--card-bg); border: 1px solid var(--card-border);">
                        <h3>HOST AUCTION</h3>
                        <p style="margin: 1rem 0; font-size: 0.9rem; color: var(--text-secondary);">Create a new room and become the Auctioneer</p>
                        <button id="btn-host" class="btn btn-primary" style="width: 100%;">Create Room</button>
                    </div>
                    
                    <div class="card" style="padding: 2rem; background: var(--card-bg); border: 1px solid var(--card-border);">
                        <h3>JOIN AUCTION</h3>
                        <p style="margin: 1rem 0; font-size: 0.9rem; color: var(--text-secondary);">Enter a room code to join as a Bidder</p>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="room-code-input" placeholder="Room Code" style="margin: 0; text-transform: uppercase;">
                            <button id="btn-join" class="btn">Join</button>
                        </div>
                    </div>
                </div>
                
                <div class="card" style="padding: 1rem; background: var(--card-bg); border: 1px dashed var(--card-border); margin-bottom: 2rem;">
                    <h3>PAST MATCHES</h3>
                    <ul id="past-matches-list" style="list-style: none; text-align: left; margin-top: 1rem; color: var(--text-secondary);">
                        <li style="text-align: center;">No history found.</li>
                    </ul>
                </div>
                <button id="btn-logout" class="btn" style="border-color: var(--error-color); color: var(--error-color);">Logout</button>
            </div>
        </section>

        <!-- Admin View -->
        <section id="admin-view" class="view hidden">
            <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2>AUCTION ROOM <span class="accent" style="font-size:0.8em">(HOST)</span> | <span id="admin-room-codes-header" class="hidden"><span id="admin-room-code" class="mono"></span></span></h2>
                <button class="btn-quit btn" style="font-size: 0.8rem;">Exit</button>
            </header>
            
            <div class="grid" style="grid-template-columns: 1fr 300px; gap: 30px;">
                <div class="main-content">
                    <!-- Setup Phase -->
                    <div id="admin-setup" class="card" style="padding: 20px; background: var(--card-bg);">
                        <h3>GAME SETUP</h3>
                        <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label style="font-size: 0.8rem; color: var(--text-secondary);">Total Purse (Points)</label>
                                <input type="number" id="input-purse" value="50">
                            </div>
                           <div>
                                <label style="font-size: 0.8rem; color: var(--text-secondary);">Managers</label>
                                <input type="number" id="input-managers" value="4">
                            </div>
                            <div>
                                <label style="font-size: 0.8rem; color: var(--text-secondary);">Max Squad Size</label>
                                <input type="number" id="input-max-squad" value="6">
                            </div>
                             <div>
                                <label style="font-size: 0.8rem; color: var(--text-secondary);">Min Squad Size</label>
                                <input type="number" id="input-min-squad" value="5">
                            </div>
                        </div>

                        <h3>PLAYER LIST</h3>
                        <div style="margin-bottom: 10px;">
                            <label style="font-size: 0.8rem; color: var(--text-secondary);">Match Name (Optional)</label>
                            <input type="text" id="input-match-name" placeholder="e.g. IPL Final 2025" style="width: 100%; margin-top: 5px;">
                        </div>
                        <p style="color: var(--text-secondary); margin-bottom: 10px;">Paste 22 players (one per line)</p>
                        <textarea id="player-list-input" rows="10" placeholder="Virat Kohli&#10;Rohit Sharma&#10;..."></textarea>
                        <button id="btn-start-auction" class="btn btn-primary" style="width: 100%;">START AUCTION</button>
                    </div>

                    <!-- Auction Control Phase -->
                    <div id="admin-controls" class="hidden">
                        <div class="player-card" style="background: var(--card-bg); padding: 40px; text-align: center; border: 1px solid var(--card-border); margin-bottom: 20px;">
                            <h4 style="color: var(--text-secondary); letter-spacing: 2px;">CURRENT PLAYER</h4>
                            <h1 id="current-player-name" style="font-size: 3rem; margin: 20px 0;">WAITING...</h1>
                            <div class="bid-info" style="font-size: 1.5rem;">
                                CURRENT BID: <span id="current-bid-display" class="accent mono">0 Pts</span>
                            </div>
                            <div class="winner-info" style="margin-top: 10px; color: var(--text-secondary);">
                                HELD BY: <span id="current-bidder-name">None</span>
                            </div>
                        </div>

                        <div class="controls-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <button id="btn-spin" class="btn btn-primary" style="height: 60px; font-size: 1.2rem;">SPIN WHEEL</button>
                            <button id="btn-sell" class="btn" style="height: 60px; font-size: 1.2rem; border-color: var(--accent-color); background: rgba(0,255,136,0.1);">SOLD</button>
                        </div>
                        
                        <div style="margin-top: 20px; border-top: 1px solid #333; padding-top: 20px;">
                            <h4 style="color: var(--text-secondary); margin-bottom: 10px;">HOST BETTING (AUDITOR)</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <button id="btn-host-bid-1" class="btn" style="grid-column: span 2;">+1 Point (Host)</button>
                            </div>
                        </div>

                        <div style="margin-top: 20px; text-align: center;">
                             <button id="btn-export" class="btn" style="font-size: 0.9rem; border-color: #3498db; color: #3498db;">DOWNLOAD RESULTS (CSV)</button>
                        </div>
                    </div>
                </div>

                <aside id="admin-sidebar" class="hidden">
                    <div class="card" style="background: var(--card-bg); padding: 20px; margin-bottom: 20px; height: auto;">
                        <h3>MY SQUAD (HOST)</h3>
                         <div style="margin-bottom:10px; font-size:0.8rem; color:var(--text-secondary);">
                            Size: <span id="host-squad-size" class="accent">0</span> / <span id="host-max-squad">6</span>
                        </div>
                        <ul id="host-squad-list" style="list-style: none; margin-top: 10px; font-size: 0.9rem;">
                            <!-- Players -->
                        </ul>
                    </div>

                    <div class="card" style="background: var(--card-bg); padding: 20px; height: auto;">
                        <h3>SQUADS</h3>
                        <div id="admin-teams-list">
                            <!-- Team stats will go here -->
                        </div>
                    </div>
                </aside>
            </div>
        </section>

        <!-- User View -->
        <section id="user-view" class="view hidden">
            <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <div>
                    <h2>AUCTION ROOM</h2>
                    <div class="mono" style="font-size: 0.9rem; color: var(--text-secondary);">BALANCE: <span id="user-balance" class="accent">0 Pts</span></div>
                </div>
                <button class="btn-quit btn" style="font-size: 0.8rem;">Leave</button>
            </header>

            <div class="grid" style="grid-template-columns: 1fr 350px;">
                <div class="main-auction-area">
                    <div class="player-display" style="background: var(--card-bg); padding: 40px; text-align: center; border: 1px solid var(--card-border); margin-bottom: 2rem;">
                        <div id="user-waiting-msg">WAITING FOR NEXT PLAYER...</div>
                        <div id="user-active-player" class="hidden">
                            <h4 style="color: var(--text-secondary);">ON THE BLOCK</h4>
                            <h1 id="user-player-name" style="font-size: 2.5rem; margin: 15px 0;">PLAYER NAME</h1>
                            <div class="price-tag" style="font-size: 2rem; color: var(--accent-color); font-family: var(--font-mono);">
                                <span id="user-current-bid">0 Pts</span>
                            </div>
                            <div style="margin-top: 10px;">Top Bidder: <span id="user-top-bidder">None</span></div>
                        </div>
                    </div>

                    <div id="bidding-controls" class="hidden" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <button id="btn-bid-1" class="btn" style="grid-column: span 2;">+1 Point</button>
                    </div>
                </div>

                <aside>
                    <div class="card" style="background: var(--card-bg); padding: 20px; margin-bottom: 20px;">
                        <h3>MY SQUAD</h3>
                         <div style="margin-bottom:10px; font-size:0.8rem; color:var(--text-secondary);">
                            Size: <span id="my-squad-size" class="accent">0</span> / <span id="my-max-squad">6</span>
                        </div>
                        <ul id="my-squad-list" style="list-style: none; margin-top: 10px; font-size: 0.9rem;">
                            <!-- Players -->
                        </ul>
                    </div>
                    <div class="card" style="background: var(--card-bg); padding: 20px;">
                        <h3>SQUADS</h3>
                        <div id="leaderboard"></div>
                    </div>
                </aside>
            </div>
        </section>
    </div>

    <!-- Scripts -->
    <script type="module" src="js/firebase-config.js?v=13-EXPORT"></script>
    <script type="module" src="js/utils.js?v=13-EXPORT"></script>
    <script type="module" src="js/auth.js?v=13-EXPORT"></script>
    <script type="module" src="js/auction.js?v=13-EXPORT"></script>
    <script type="module" src="js/app.js?v=13-EXPORT"></script>
</body>
</html>
